216   Chapter 9 Medians and Order Statistics


         R ANDOMIZED -S ELECT uses the procedure R ANDOMIZED -PARTITION intro-
      duced in Section 7.3. Thus, like R ANDOMIZED -Q UICKSORT, it is a randomized al-
      gorithm, since its behavior is determined in part by the output of a random-number
      generator. The following code for R ANDOMIZED -S ELECT returns the ith smallest
      element of the array AŒp : : r.

      R ANDOMIZED -S ELECT .A; p; r; i/
      1 if p == r
      2      return AŒp
      3 q D R ANDOMIZED -PARTITION .A; p; r/
      4 k D qpC1
      5 if i == k        // the pivot value is the answer
      6      return AŒq
      7 elseif i < k
      8      return R ANDOMIZED -S ELECT .A; p; q  1; i/
      9 else return R ANDOMIZED -S ELECT .A; q C 1; r; i  k/

         The R ANDOMIZED -S ELECT procedure works as follows. Line 1 checks for the
      base case of the recursion, in which the subarray AŒp : : r consists of just one
      element. In this case, i must equal 1, and we simply return AŒp in line 2 as the
      ith smallest element. Otherwise, the call to R ANDOMIZED -PARTITION in line 3
      partitions the array AŒp : : r into two (possibly empty) subarrays AŒp : : q  1
      and AŒq C 1 : : r such that each element of AŒp : : q  1 is less than or equal
      to AŒq, which in turn is less than each element of AŒq C 1 : : r. As in quicksort,
      we will refer to AŒq as the pivot element. Line 4 computes the number k of
      elements in the subarray AŒp : : q, that is, the number of elements in the low side
      of the partition, plus one for the pivot element. Line 5 then checks whether AŒq is
      the ith smallest element. If it is, then line 6 returns AŒq. Otherwise, the algorithm
      determines in which of the two subarrays AŒp : : q  1 and AŒq C 1 : : r the ith
      smallest element lies. If i < k, then the desired element lies on the low side of
      the partition, and line 8 recursively selects it from the subarray. If i > k, however,
      then the desired element lies on the high side of the partition. Since we already
      know k values that are smaller than the ith smallest element of AŒp : : r—namely,
      the elements of AŒp : : q—the desired element is the .i  k/th smallest element
      of AŒq C 1 : : r, which line 9 ﬁnds recursively. The code appears to allow recursive
      calls to subarrays with 0 elements, but Exercise 9.2-1 asks you to show that this
      situation cannot happen.
         The worst-case running time for R ANDOMIZED -S ELECT is ‚.n2 /, even to ﬁnd
      the minimum, because we could be extremely unlucky and always partition around
      the largest remaining element, and partitioning takes ‚.n/ time. We will see that
