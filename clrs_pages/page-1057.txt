1036   Chapter 33 Computational Geometry


          be either in the interior of the triangle formed by p0 , pr , and pi or on a side of
          this triangle (but it is not a vertex of the triangle). Clearly, since p t is within a
          triangle formed by three other points of Qi , it cannot be a vertex of CH.Qi /.
          Since p t is not a vertex of CH.Qi /, we have that

          CH.Qi  fp t g/ D CH.Qi / :                                                    (33.1)

          Let Pi be the set of points that were popped during iteration i of the for loop.
          Since the equality (33.1) applies for all points in Pi , we can apply it repeatedly
          to show that CH.Qi  Pi / D CH.Qi /. But Qi  Pi D Qj [ fpi g, and so we
          conclude that CH.Qj [ fpi g/ D CH.Qi  Pi / D CH.Qi /.
          We have shown that once we push pi , stack S contains exactly the vertices
          of CH.Qi / in counterclockwise order from bottom to top. Incrementing i will
          then cause the loop invariant to hold for the next iteration.
       Termination: When the loop terminates, we have i D m C 1, and so the loop
          invariant implies that stack S consists of exactly the vertices of CH.Qm /, which
          is CH.Q/, in counterclockwise order from bottom to top. This completes the
          proof.

          We now show that the running time of G RAHAM -S CAN is O.n lg n/, where
       n D jQj. Line 1 takes ‚.n/ time. Line 2 takes O.n lg n/ time, using merge sort
       or heapsort to sort the polar angles and the cross-product method of Section 33.1
       to compare angles. (We can remove all but the farthest point with the same polar
       angle in total of O.n/ time over all n points.) Lines 3–6 take O.1/ time. Because
       m  n  1, the for loop of lines 7–10 executes at most n  3 times. Since P USH
       takes O.1/ time, each iteration takes O.1/ time exclusive of the time spent in the
       while loop of lines 8–9, and thus overall the for loop takes O.n/ time exclusive of
       the nested while loop.
          We use aggregate analysis to show that the while loop takes O.n/ time overall.
       For i D 0; 1; : : : ; m, we push each point pi onto stack S exactly once. As in the
       analysis of the M ULTIPOP procedure of Section 17.1, we observe that we can pop at
       most the number of items that we push. At least three points—p0 , p1 , and pm —are
       never popped from the stack, so that in fact at most m  2 P OP operations are
       performed in total. Each iteration of the while loop performs one P OP, and so
       there are at most m  2 iterations of the while loop altogether. Since the test in
       line 8 takes O.1/ time, each call of P OP takes O.1/ time, and m  n  1, the total
       time taken by the while loop is O.n/. Thus, the running time of G RAHAM -S CAN
       is O.n lg n/.
