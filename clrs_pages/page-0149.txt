128   Chapter 5 Probabilistic Analysis and Randomized Algorithms


         Pr fE2 \ E1 g D Pr fE2 j E1 g Pr fE1 g
                              1       .n  i C 1/Š
                       D            
                         ni C1            nŠ
                         .n  i/Š
                       D          :
                             nŠ
      Termination: At termination, i D n C 1, and we have that the subarray AŒ1 : : n
         is a given n-permutation with probability .n.nC1/C1/=nŠ D 0Š=nŠ D 1=nŠ.

        Thus, R ANDOMIZE -I N -P LACE produces a uniform random permutation.

        A randomized algorithm is often the simplest and most efﬁcient way to solve a
      problem. We shall use randomized algorithms occasionally throughout this book.

      Exercises

      5.3-1
      Professor Marceau objects to the loop invariant used in the proof of Lemma 5.5. He
      questions whether it is true prior to the ﬁrst iteration. He reasons that we could just
      as easily declare that an empty subarray contains no 0-permutations. Therefore,
      the probability that an empty subarray contains a 0-permutation should be 0, thus
      invalidating the loop invariant prior to the ﬁrst iteration. Rewrite the procedure
      R ANDOMIZE -I N -P LACE so that its associated loop invariant applies to a nonempty
      subarray prior to the ﬁrst iteration, and modify the proof of Lemma 5.5 for your
      procedure.

      5.3-2
      Professor Kelp decides to write a procedure that produces at random any permuta-
      tion besides the identity permutation. He proposes the following procedure:

      P ERMUTE -W ITHOUT-I DENTITY .A/
      1 n D A:length
      2 for i D 1 to n  1
      3      swap AŒi with AŒR ANDOM.i C 1; n/

      Does this code do what Professor Kelp intends?

      5.3-3
      Suppose that instead of swapping element AŒi with a random element from the
      subarray AŒi : : n, we swapped it with a random element from anywhere in the
      array:
