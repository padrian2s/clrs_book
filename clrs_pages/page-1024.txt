32.4 The Knuth-Morris-Pratt algorithm                                                  1003


a 2 †, the value Œq contains the information we need to compute ı.q; a/ but
that does not depend on a. Since the array  has only m entries, whereas ı has
‚.m j†j/ entries, we save a factor of j†j in the preprocessing time by computing 
rather than ı.

The preﬁx function for a pattern
The preﬁx function  for a pattern encapsulates knowledge about how the pat-
tern matches against shifts of itself. We can take advantage of this information to
avoid testing useless shifts in the naive pattern-matching algorithm and to avoid
precomputing the full transition function ı for a string-matching automaton.
   Consider the operation of the naive string matcher. Figure 32.10(a) shows a
particular shift s of a template containing the pattern P D ababaca against a
text T . For this example, q D 5 of the characters have matched successfully, but
the 6th pattern character fails to match the corresponding text character. The infor-
mation that q characters have matched successfully determines the corresponding
text characters. Knowing these q text characters allows us to determine immedi-
ately that certain shifts are invalid. In the example of the ﬁgure, the shift s C 1 is
necessarily invalid, since the ﬁrst pattern character (a) would be aligned with a text
character that we know does not match the ﬁrst pattern character, but does match
the second pattern character (b). The shift s 0 D s C 2 shown in part (b) of the ﬁg-
ure, however, aligns the ﬁrst three pattern characters with three text characters that
must necessarily match. In general, it is useful to know the answer to the following
question:
   Given that pattern characters P Œ1 : : q match text characters T ŒsC1 : : sCq,
   what is the least shift s 0 > s such that for some k < q,

   P Œ1 : : k D T Œs 0 C 1 : : s 0 C k ;                                       (32.6)

   where s 0 C k D s C q?
In other words, knowing that Pq = TsCq , we want the longest proper preﬁx Pk
of Pq that is also a sufﬁx of TsCq . (Since s 0 C k D s C q, if we are given s
and q, then ﬁnding the smallest shift s 0 is tantamount to ﬁnding the longest preﬁx
length k.) We add the difference q  k in the lengths of these preﬁxes of P to the
shift s to arrive at our new shift s 0 , so that s 0 D s C .q  k/. In the best case, k D 0,
so that s 0 D s C q, and we immediately rule out shifts s C 1; s C 2; : : : ; s C q  1.
In any case, at the new shift s 0 we don’t need to compare the ﬁrst k characters of P
with the corresponding characters of T , since equation (32.6) guarantees that they
match.
   We can precompute the necessary information by comparing the pattern against
itself, as Figure 32.10(c) demonstrates. Since T Œs 0 C 1 : : s 0 C k is part of the
