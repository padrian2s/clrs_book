        32.4 The Knuth-Morris-Pratt algorithm                                                            1005



                                            P5       a b a b a c a


                                            P3              a b a b a c a                            Œ5 D 3

                                            P1                      a b a b a c a                    Œ3 D 1
    i   1 2 3 4 5 6 7
P Œi   a b a b a c a
                                            P0                      " a b a b a c a                  Œ1 D 0
Œi    0 0 1 2 3 0 1

                 (a)                                                 (b)


        Figure 32.11 An illustration of Lemma 32.5 for the pattern P D ababaca and q D 5. (a) The 
        function for the given pattern. Since Œ5 D 3, Œ3 D 1, and Œ1 D 0, by iterating  we obtain
          Œ5 D f3; 1; 0g. (b) We slide the template containing the pattern P to the right and note when some
        preﬁx Pk of P matches up with some proper sufﬁx of P5 ; we get matches when k D 3, 1, and 0. In
        the ﬁgure, the ﬁrst row gives P , and the dotted vertical line is drawn just after P5 . Successive rows
        show all the shifts of P that cause some preﬁx Pk of P to match some sufﬁx of P5 . Successfully
        matched characters are shown shaded. Vertical lines connect aligned matching characters. Thus,
        fk W k < 5 and Pk = P5 g D f3; 1; 0g. Lemma 32.5 claims that   Œq D fk W k < q and Pk = Pq g
        for all q.


           The pseudocode below gives the Knuth-Morris-Pratt matching algorithm as
        the procedure KMP-M ATCHER. For the most part, the procedure follows from
        F INITE -AUTOMATON -M ATCHER, as we shall see. KMP-M ATCHER calls the aux-
        iliary procedure C OMPUTE -P REFIX -F UNCTION to compute .

        KMP-M ATCHER .T; P /
         1 n D T:length
         2 m D P:length
         3  D C OMPUTE -P REFIX -F UNCTION .P /
         4 q D0                                         // number of characters matched
         5 for i D 1 to n                               // scan the text from left to right
         6      while q > 0 and P Œq C 1 ¤ T Œi
         7           q D Œq                           // next character does not match
         8      if P Œq C 1 == T Œi
         9           q D qC1                            // next character matches
        10      if q == m                               // is all of P matched?
        11           print “Pattern occurs with shift” i  m
        12           q D Œq                           // look for the next match
