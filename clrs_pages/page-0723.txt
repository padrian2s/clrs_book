702   Chapter 25 All-Pairs Shortest Paths


      Therefore, any path p from 0 to k has y         w.p/ D w.p/ C h.0 /  h.k /. Be-
      cause h.0 / and h.k / do not depend on the path, if one path from 0 to k is
      shorter than another using weight function w, then it is also shorter using y w. Thus,
      w.p/ D ı.0 ; k / if and only if y            y
                                             w.p/ D ı.0 ; k /.
        Finally, we show that G has a negative-weight cycle using weight function w if
      and only if G has a negative-weight cycle using weight function y       w. Consider any
      cycle c D h0 ; 1 ; : : : ; k i, where 0 D k . By equation (25.10),
      w.c/ D w.c/ C h.0 /  h.k /
      y
           D w.c/ ;
      and thus c has negative weight using w if and only if it has negative weight us-
      ing y
          w.

      Producing nonnegative weights by reweighting
      Our next goal is to ensure that the second property holds: we want y     w.u; / to be
      nonnegative for all edges .u; / 2 E. Given a weighted, directed graph G D
      .V; E/ with weight function w W E ! R, we make a new graph G 0 D .V 0 ; E 0 /,
      where V 0 D V [ fsg for some new vertex s 62 V and E 0 D E [ f.s; / W  2 V g.
      We extend the weight function w so that w.s; / D 0 for all  2 V . Note that
      because s has no edges that enter it, no shortest paths in G 0 , other than those with
      source s, contain s. Moreover, G 0 has no negative-weight cycles if and only if G
      has no negative-weight cycles. Figure 25.6(a) shows the graph G 0 corresponding
      to the graph G of Figure 25.1.
         Now suppose that G and G 0 have no negative-weight cycles. Let us deﬁne
      h./ D ı.s; / for all  2 V 0 . By the triangle inequality (Lemma 24.10),
      we have h./  h.u/ C w.u; / for all edges .u; / 2 E 0 . Thus, if we de-
      ﬁne the new weights w  y by reweighting according to equation (25.9), we have
      w.u; / D w.u; / C h.u/  h./  0, and we have satisﬁed the second property.
       y
      Figure 25.6(b) shows the graph G 0 from Figure 25.6(a) with reweighted edges.

      Computing all-pairs shortest paths
      Johnson’s algorithm to compute all-pairs shortest paths uses the Bellman-Ford al-
      gorithm (Section 24.1) and Dijkstra’s algorithm (Section 24.3) as subroutines. It
      assumes implicitly that the edges are stored in adjacency lists. The algorithm re-
      turns the usual jV j jV j matrix D D dij , where dij D ı.i; j /, or it reports that
      the input graph contains a negative-weight cycle. As is typical for an all-pairs
      shortest-paths algorithm, we assume that the vertices are numbered from 1 to jV j.
