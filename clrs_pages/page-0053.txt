32           Chapter 2 Getting Started


             8   9   10 11 12 13 14 15 16 17                              8   9   10 11 12 13 14 15 16 17
         A … 2       4   5   7   1   2   3   6 …                      A … 1       4   5   7   1   2   3   6 …
             k                                                                    k
         1   2   3   4   5           1   2   3   4   5                1   2   3   4   5           1   2   3   4   5
     L   2   4   5   7 ∞         R 1     2   3   6 ∞              L   2   4   5   7 ∞         R 1     2   3   6 ∞
         i                         j                                  i                               j
                             (a)                                                          (b)


             8   9   10 11 12 13 14 15 16 17                              8   9   10 11 12 13 14 15 16 17
         A … 1       2   5   7   1   2   3   6 …                      A … 1       2   2   7   1   2   3   6 …
                         k                                                                k
         1   2   3   4   5           1   2   3   4   5                1   2   3   4   5           1   2   3   4   5
     L   2   4   5   7 ∞         R 1     2   3   6 ∞              L   2   4   5   7 ∞         R 1     2   3   6 ∞
             i                           j                                i                               j
                             (c)                                                          (d)


             Figure 2.3 The operation of lines 10–17 in the call M ERGE.A; 9; 12; 16/, when the subarray
             AŒ9 : : 16 contains the sequence h2; 4; 5; 7; 1; 2; 3; 6i. After copying and inserting sentinels, the
             array L contains h2; 4; 5; 7; 1i, and the array R contains h1; 2; 3; 6; 1i. Lightly shaded positions
             in A contain their ﬁnal values, and lightly shaded positions in L and R contain values that have yet
             to be copied back into A. Taken together, the lightly shaded positions always comprise the values
             originally in AŒ9 : : 16, along with the two sentinels. Heavily shaded positions in A contain values
             that will be copied over, and heavily shaded positions in L and R contain values that have already
             been copied back into A. (a)–(h) The arrays A, L, and R, and their respective indices k, i, and j
             prior to each iteration of the loop of lines 12–17.


             trated in Figure 2.3, perform the r  p C 1 basic steps by maintaining the following
             loop invariant:

                 At the start of each iteration of the for loop of lines 12–17, the subarray
                 AŒp : : k  1 contains the k  p smallest elements of LŒ1 : : n1 C 1 and
                 RŒ1 : : n2 C 1, in sorted order. Moreover, LŒi and RŒj  are the smallest
                 elements of their arrays that have not been copied back into A.

                We must show that this loop invariant holds prior to the ﬁrst iteration of the for
             loop of lines 12–17, that each iteration of the loop maintains the invariant, and
             that the invariant provides a useful property to show correctness when the loop
             terminates.
             Initialization: Prior to the ﬁrst iteration of the loop, we have k D p, so that the
                subarray AŒp : : k  1 is empty. This empty subarray contains the k  p D 0
                smallest elements of L and R, and since i D j D 1, both LŒi and RŒj  are the
                smallest elements of their arrays that have not been copied back into A.
