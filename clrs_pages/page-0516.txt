18.2 Basic operations on B-trees                                                 495


of x, positioned just after y in x’s table of children. The median key of y moves
up to become the key in x that separates y and ´.
   Lines 1–9 create node ´ and give it the largest t  1 keys and corresponding t
children of y. Line 10 adjusts the key count for y. Finally, lines 11–17 insert ´ as
a child of x, move the median key from y up to x in order to separate y from ´,
and adjust x’s key count. Lines 18–20 write out all modiﬁed disk pages. The
CPU time used by B-T REE -S PLIT-C HILD is ‚.t/, due to the loops on lines 5–6
and 8–9. (The other loops run for O.t/ iterations.) The procedure performs O.1/
disk operations.

Inserting a key into a B-tree in a single pass down the tree
We insert a key k into a B-tree T of height h in a single pass down the tree, re-
quiring O.h/ disk accesses. The CPU time required is O.th/ D O.t log t n/. The
B-T REE -I NSERT procedure uses B-T REE -S PLIT-C HILD to guarantee that the re-
cursion never descends to a full node.

B-T REE -I NSERT .T; k/
 1 r D T:root
 2 if r:n == 2t  1
 3       s D A LLOCATE -N ODE ./
 4       T:root D s
 5       s:leaf D FALSE
 6       s:n D 0
 7       s:c1 D r
 8       B-T REE -S PLIT-C HILD .s; 1/
 9       B-T REE -I NSERT-N ONFULL .s; k/
10 else B-T REE -I NSERT-N ONFULL .r; k/

Lines 3–9 handle the case in which the root node r is full: the root splits and a
new node s (having two children) becomes the root. Splitting the root is the only
way to increase the height of a B-tree. Figure 18.6 illustrates this case. Unlike a
binary search tree, a B-tree increases in height at the top instead of at the bottom.
The procedure ﬁnishes by calling B-T REE -I NSERT-N ONFULL to insert key k into
the tree rooted at the nonfull root node. B-T REE -I NSERT-N ONFULL recurses as
necessary down the tree, at all times guaranteeing that the node to which it recurses
is not full by calling B-T REE -S PLIT-C HILD as necessary.
   The auxiliary recursive procedure B-T REE -I NSERT-N ONFULL inserts key k into
node x, which is assumed to be nonfull when the procedure is called. The operation
of B-T REE -I NSERT and the recursive operation of B-T REE -I NSERT-N ONFULL
guarantee that this assumption is true.
