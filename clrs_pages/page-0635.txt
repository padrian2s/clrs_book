614   Chapter 22 Elementary Graph Algorithms


      Lemma 22.11
      A directed graph G is acyclic if and only if a depth-ﬁrst search of G yields no back
      edges.

      Proof ): Suppose that a depth-ﬁrst search produces a back edge .u; /. Then
      vertex  is an ancestor of vertex u in the depth-ﬁrst forest. Thus, G contains a path
      from  to u, and the back edge .u; / completes a cycle.
         (: Suppose that G contains a cycle c. We show that a depth-ﬁrst search of G
      yields a back edge. Let  be the ﬁrst vertex to be discovered in c, and let .u; / be
      the preceding edge in c. At time :d, the vertices of c form a path of white vertices
      from  to u. By the white-path theorem, vertex u becomes a descendant of  in the
      depth-ﬁrst forest. Therefore, .u; / is a back edge.

      Theorem 22.12
      T OPOLOGICAL -S ORT produces a topological sort of the directed acyclic graph
      provided as its input.

      Proof Suppose that DFS is run on a given dag G D .V; E/ to determine ﬁn-
      ishing times for its vertices. It sufﬁces to show that for any pair of distinct ver-
      tices u;  2 V , if G contains an edge from u to , then :f < u:f . Consider any
      edge .u; / explored by DFS.G/. When this edge is explored,  cannot be gray,
      since then  would be an ancestor of u and .u; / would be a back edge, contra-
      dicting Lemma 22.11. Therefore,  must be either white or black. If  is white,
      it becomes a descendant of u, and so :f < u:f . If  is black, it has already been
      ﬁnished, so that :f has already been set. Because we are still exploring from u, we
      have yet to assign a timestamp to u:f , and so once we do, we will have :f < u:f
      as well. Thus, for any edge .u; / in the dag, we have :f < u:f , proving the
      theorem.

      Exercises

      22.4-1
      Show the ordering of vertices produced by T OPOLOGICAL -S ORT when it is run on
      the dag of Figure 22.8, under the assumption of Exercise 22.3-2.

      22.4-2
      Give a linear-time algorithm that takes as input a directed acyclic graph G D
      .V; E/ and two vertices s and t, and returns the number of simple paths from s
      to t in G. For example, the directed acyclic graph of Figure 22.8 contains exactly
      four simple paths from vertex p to vertex : po, pory, posry, and psry.
      (Your algorithm needs only to count the simple paths, not list them.)
