1004   Chapter 32 String Matching


        b a c b a b a b a a b c b a b                              T

              s            a b a b a c a            P
                               q
                                  (a)


        b a c b a b a b a a b c b a b                              T

              s′ = s + 2       a b a b a c a               P
                                   k
                                  (b)


                           a b a b a        Pq


                               a b a        Pk

                                  (c)


       Figure 32.10 The preﬁx function . (a) The pattern P D ababaca aligns with a text T so that
       the ﬁrst q D 5 characters match. Matching characters, shown shaded, are connected by vertical lines.
       (b) Using only our knowledge of the 5 matched characters, we can deduce that a shift of s C 1 is
       invalid, but that a shift of s 0 D sC2 is consistent with everything we know about the text and therefore
       is potentially valid. (c) We can precompute useful information for such deductions by comparing the
       pattern with itself. Here, we see that the longest preﬁx of P that is also a proper sufﬁx of P5 is P3 .
       We represent this precomputed information in the array , so that Œ5 D 3. Given that q characters
       have matched successfully at shift s, the next potentially valid shift is at s 0 D s C.q Œq/ as shown
       in part (b).


       known portion of the text, it is a sufﬁx of the string Pq . Therefore, we can interpret
       equation (32.6) as asking for the greatest k < q such that Pk = Pq . Then, the new
       shift s 0 D s C.q k/ is the next potentially valid shift. We will ﬁnd it convenient to
       store, for each value of q, the number k of matching characters at the new shift s 0 ,
       rather than storing, say, s 0  s.
          We formalize the information that we precompute as follows. Given a pattern
       P Œ1 : : m, the preﬁx function for the pattern P is the function  W f1; 2; : : : ; mg !
       f0; 1; : : : ; m  1g such that
       Œq D max fk W k < q and Pk = Pq g :
       That is, Œq is the length of the longest preﬁx of P that is a proper sufﬁx of Pq .
       Figure 32.11(a) gives the complete preﬁx function  for the pattern ababaca.
