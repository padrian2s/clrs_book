340                Chapter 14 Augmenting Data Structures


                                                                          26
                                                                          20
                                        17                                                             41
                                        12                                                             7
                        14                                21                           30                             47
                         7                                4                             5                              1
              10                   16        19                      21        28                38
              4                    2          2                       1        1                  3
          7        12        14                      20        key                          35         39
          2         1         1                       1                                      1         1
      3                                                        size
      1




                   Figure 14.1 An order-statistic tree, which is an augmented red-black tree. Shaded nodes are red,
                   and darkened nodes are black. In addition to its usual attributes, each node x has an attribute x: size,
                   which is the number of nodes, other than the sentinel, in the subtree rooted at x.


                      Figure 14.1 shows a data structure that can support fast order-statistic operations.
                   An order-statistic tree T is simply a red-black tree with additional information
                   stored in each node. Besides the usual red-black tree attributes x:key, x:color, x:p,
                   x:left, and x:right in a node x, we have another attribute, x:size. This attribute
                   contains the number of (internal) nodes in the subtree rooted at x (including x
                   itself), that is, the size of the subtree. If we deﬁne the sentinel’s size to be 0—that
                   is, we set T:nil:size to be 0—then we have the identity
                   x:size D x:left:size C x:right:size C 1 :
                      We do not require keys to be distinct in an order-statistic tree. (For example, the
                   tree in Figure 14.1 has two keys with value 14 and two keys with value 21.) In the
                   presence of equal keys, the above notion of rank is not well deﬁned. We remove
                   this ambiguity for an order-statistic tree by deﬁning the rank of an element as the
                   position at which it would be printed in an inorder walk of the tree. In Figure 14.1,
                   for example, the key 14 stored in a black node has rank 5, and the key 14 stored in
                   a red node has rank 6.

                   Retrieving an element with a given rank
                   Before we show how to maintain this size information during insertion and dele-
                   tion, let us examine the implementation of two order-statistic queries that use this
                   additional information. We begin with an operation that retrieves an element with
                   a given rank. The procedure OS-S ELECT .x; i/ returns a pointer to the node con-
                   taining the ith smallest key in the subtree rooted at x. To ﬁnd the node with the ith
                   smallest key in an order-statistic tree T , we call OS-S ELECT .T:root; i/.
