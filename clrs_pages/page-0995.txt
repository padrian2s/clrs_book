974   Chapter 31 Number-Theoretic Algorithms


      Proof Using Theorem 31.38, we see that if n is composite, then each execution of
      the for loop of lines 1–4 has a probability of at least 1=2 of discovering a witness x
      to the compositeness of n. M ILLER -R ABIN makes an error only if it is so unlucky
      as to miss discovering a witness to the compositeness of n on each of the s iterations
      of the main loop. The probability of such a sequence of misses is at most 2s .

         If n is prime, M ILLER -R ABIN always reports P RIME, and if n is composite, the
      chance that M ILLER -R ABIN reports P RIME is at most 2s .
         When applying M ILLER -R ABIN to a large randomly chosen integer n, however,
      we need to consider as well the prior probability that n is prime, in order to cor-
      rectly interpret M ILLER -R ABIN’s result. Suppose that we ﬁx a bit length ˇ and
      choose at random an integer n of length ˇ bits to be tested for primality. Let A
      denote the event that n is prime. By the prime number theorem (Theorem 31.37),
      the probability that n is prime is approximately
      Pr fAg  1= ln n
              1:443=ˇ :
      Now˚ let B denote the event that M ILLER -R ABIN returns P RIME
                                                                    ˚ . We have that
      Pr B j A D 0 (or equivalently, that Pr fB j Ag D 1) and Pr B j A  2s (or
                           ˚
      equivalently, that Pr B j A > 1  2s ).
         But what is Pr fA j Bg, the probability that n is prime, given that M ILLER -
      R ABIN has returned P RIME? By the alternate form of Bayes’s theorem (equa-
      tion (C.18)) we have
                                   Pr fAg Pr fB j Ag
      Pr fA j Bg D                             ˚     ˚
                        Pr fAg Pr fB j Ag C Pr A Pr B j A
                                1
                            s
                                           :
                        1 C 2 .ln n  1/
      This probability does not exceed 1=2 until s exceeds lg.ln n  1/. Intuitively, that
      many initial trials are needed just for the conﬁdence derived from failing to ﬁnd a
      witness to the compositeness of n to overcome the prior bias in favor of n being
      composite. For a number with ˇ D 1024 bits, this initial testing requires about
      lg.ln n  1/  lg.ˇ=1:443/
                    9
      trials. In any case, choosing s D 50 should sufﬁce for almost any imaginable
      application.
         In fact, the situation is much better. If we are trying to ﬁnd large primes by
      applying M ILLER -R ABIN to large randomly chosen odd integers, then choosing
      a small value of s (say 3) is very unlikely to lead to erroneous results, though
