     33.3 Finding the convex hull                                                                     1035


                pj               pk                                               pj


pi                                                        pi                 pr

                                                                   pt
                            Qj
                                                p2


                                           p1                                                          p1

         p0                                                             p0
                      (a)                                                              (b)


     Figure 33.8 The proof of correctness of G RAHAM -S CAN. (a) Because pi ’s polar angle relative
     to p0 is greater than pj ’s polar angle, and because the angle †pk pj pi makes a left turn, adding pi
     to CH.Qj / gives exactly the vertices of CH.Qj [ fpi g/. (b) If the angle †pr p t pi makes a nonleft
     turn, then p t is either in the interior of the triangle formed by p0 , pr , and pi or on a side of the
     triangle, which means that it cannot be a vertex of CH.Qi /.


         vertices forms its own convex hull. Moreover, they appear in counterclockwise
         order from bottom to top.
     Maintenance: Entering an iteration of the for loop, the top point on stack S
       is pi 1 , which was pushed at the end of the previous iteration (or before the
       ﬁrst iteration, when i D 3). Let pj be the top point on S after executing the
       while loop of lines 8–9 but before line 10 pushes pi , and let pk be the point
       just below pj on S. At the moment that pj is the top point on S and we have
       not yet pushed pi , stack S contains exactly the same points it contained after
       iteration j of the for loop. By the loop invariant, therefore, S contains exactly
       the vertices of CH.Qj / at that moment, and they appear in counterclockwise
       order from bottom to top.
         Let us continue to focus on this moment just before pushing pi . We know
         that pi ’s polar angle relative to p0 is greater than pj ’s polar angle and that
         the angle †pk pj pi makes a left turn (otherwise we would have popped pj ).
         Therefore, because S contains exactly the vertices of CH.Qj /, we see from
         Figure 33.8(a) that once we push pi , stack S will contain exactly the vertices
         of CH.Qj [ fpi g/, still in counterclockwise order from bottom to top.
         We now show that CH.Qj [fpi g/ is the same set of points as CH.Qi /. Consider
         any point p t that was popped during iteration i of the for loop, and let pr be
         the point just below p t on stack S at the time p t was popped (pr might be pj ).
         The angle †pr p t pi makes a nonleft turn, and the polar angle of p t relative
         to p0 is greater than the polar angle of pr . As Figure 33.8(b) shows, p t must
