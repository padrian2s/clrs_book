516   Chapter 19 Fibonacci Heaps


      C ONSOLIDATE .H /
       1 let AŒ0 : : D.H:n/ be a new array
       2 for i D 0 to D.H:n/
       3      AŒi D NIL
       4 for each node w in the root list of H
       5      x Dw
       6      d D x:degree
       7      while AŒd  ¤ NIL
       8            y D AŒd             // another node with the same degree as x
       9            if x:key > y:key
      10                  exchange x with y
      11            F IB -H EAP -L INK .H; y; x/
      12            AŒd  D NIL
      13            d D d C1
      14      AŒd  D x
      15 H:min D NIL
      16 for i D 0 to D.H:n/
      17      if AŒi ¤ NIL
      18            if H:min == NIL
      19                  create a root list for H containing just AŒi
      20                  H:min D AŒi
      21            else insert AŒi into H ’s root list
      22                  if AŒi:key < H:min:key
      23                       H:min D AŒi

      F IB -H EAP -L INK .H; y; x/
      1 remove y from the root list of H
      2 make y a child of x, incrementing x:degree
      3 y:mark D FALSE

         In detail, the C ONSOLIDATE procedure works as follows. Lines 1–3 allocate
      and initialize the array A by making each entry NIL. The for loop of lines 4–14
      processes each root w in the root list. As we link roots together, w may be linked
      to some other node and no longer be a root. Nevertheless, w is always in a tree
      rooted at some node x, which may or may not be w itself. Because we want at
      most one root with each degree, we look in the array A to see whether it contains
      a root y with the same degree as x. If it does, then we link the roots x and y but
      guaranteeing that x remains a root after linking. That is, we link y to x after ﬁrst
      exchanging the pointers to the two roots if y’s key is smaller than x’s key. After
      we link y to x, the degree of x has increased by 1, and so we continue this process,
      linking x and another root whose degree equals x’s new degree, until no other root
