392   Chapter 15 Dynamic Programming


      Step 1: Characterizing a longest common subsequence
      In a brute-force approach to solving the LCS problem, we would enumerate all
      subsequences of X and check each subsequence to see whether it is also a subse-
      quence of Y , keeping track of the longest subsequence we ﬁnd. Each subsequence
      of X corresponds to a subset of the indices f1; 2; : : : ; mg of X . Because X has 2m
      subsequences, this approach requires exponential time, making it impractical for
      long sequences.
         The LCS problem has an optimal-substructure property, however, as the follow-
      ing theorem shows. As we shall see, the natural classes of subproblems corre-
      spond to pairs of “preﬁxes” of the two input sequences. To be precise, given a
      sequence X D hx1 ; x2 ; : : : ; xm i, we deﬁne the ith preﬁx of X , for i D 0; 1; : : : ; m,
      as Xi D hx1 ; x2 ; : : : ; xi i. For example, if X D hA; B; C; B; D; A; Bi, then
      X4 D hA; B; C; Bi and X0 is the empty sequence.

      Theorem 15.1 (Optimal substructure of an LCS)
      Let X D hx1 ; x2 ; : : : ; xm i and Y D hy1 ; y2 ; : : : ; yn i be sequences, and let Z D
      h´1 ; ´2 ; : : : ; ´k i be any LCS of X and Y .
      1. If xm D yn , then ´k D xm D yn and Zk1 is an LCS of Xm1 and Yn1 .
      2. If xm ¤ yn , then ´k ¤ xm implies that Z is an LCS of Xm1 and Y .
      3. If xm ¤ yn , then ´k ¤ yn implies that Z is an LCS of X and Yn1 .


      Proof (1) If ´k ¤ xm , then we could append xm D yn to Z to obtain a common
      subsequence of X and Y of length k C 1, contradicting the supposition that Z is
      a longest common subsequence of X and Y . Thus, we must have ´k D xm D yn .
      Now, the preﬁx Zk1 is a length-.k  1/ common subsequence of Xm1 and Yn1 .
      We wish to show that it is an LCS. Suppose for the purpose of contradiction
      that there exists a common subsequence W of Xm1 and Yn1 with length greater
      than k  1. Then, appending xm D yn to W produces a common subsequence of
      X and Y whose length is greater than k, which is a contradiction.
         (2) If ´k ¤ xm , then Z is a common subsequence of Xm1 and Y . If there were a
      common subsequence W of Xm1 and Y with length greater than k, then W would
      also be a common subsequence of Xm and Y , contradicting the assumption that Z
      is an LCS of X and Y .
         (3) The proof is symmetric to (2).

        The way that Theorem 15.1 characterizes longest common subsequences tells
      us that an LCS of two sequences contains within it an LCS of preﬁxes of the two
      sequences. Thus, the LCS problem has an optimal-substructure property. A recur-
