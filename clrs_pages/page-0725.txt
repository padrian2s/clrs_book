704   Chapter 25 All-Pairs Shortest Paths


      J OHNSON .G; w/
        1 compute G 0 , where G 0 :V D G:V [ fsg,
               G 0 :E D G:E [ f.s; / W  2 G:Vg, and
               w.s; / D 0 for all  2 G:V
        2 if B ELLMAN -F ORD .G 0 ; w; s/ == FALSE
        3      print “the input graph contains a negative-weight cycle”
        4 else for each vertex  2 G 0 :V
        5            set h./ to the value of ı.s; /
                          computed by the Bellman-Ford algorithm
        6      for each edge .u; / 2 G 0 :E
        7            w.u; / D w.u; / C h.u/  h./
                      y
        8      let D D .du / be a new n n matrix
        9      for each vertex u 2 G:V
      10             run D IJKSTRA .G; y w; u/ to compute y
                                                          ı.u; / for all  2 G:V
      11             for each vertex  2 G:V
      12                  du D y ı.u; / C h./  h.u/
      13       return D

      This code simply performs the actions we speciﬁed earlier. Line 1 produces G 0 .
      Line 2 runs the Bellman-Ford algorithm on G 0 with weight function w and source
      vertex s. If G 0 , and hence G, contains a negative-weight cycle, line 3 reports the
      problem. Lines 4–12 assume that G 0 contains no negative-weight cycles. Lines 4–5
      set h./ to the shortest-path weight ı.s; / computed by the Bellman-Ford algo-
      rithm for all  2 V 0 . Lines 6–7 compute the new weights y w. For each pair of ver-
      tices u;  2 V , the for loop of lines 9–12 computes the shortest-path weight y
                                                                                    ı.u; /
      by calling Dijkstra’s algorithm once from each vertex in V . Line 12 stores in
      matrix entry du the correct shortest-path weight ı.u; /, calculated using equa-
      tion (25.10). Finally, line 13 returns the completed D matrix. Figure 25.6 depicts
      the execution of Johnson’s algorithm.
         If we implement the min-priority queue in Dijkstra’s algorithm by a Fibonacci
      heap, Johnson’s algorithm runs in O.V 2 lg V CVE/ time. The simpler binary min-
      heap implementation yields a running time of O.VE lg V /, which is still asymp-
      totically faster than the Floyd-Warshall algorithm if the graph is sparse.

      Exercises

      25.3-1
      Use Johnson’s algorithm to ﬁnd the shortest paths between all pairs of vertices in
      the graph of Figure 25.2. Show the values of h and w
                                                         y computed by the algorithm.
